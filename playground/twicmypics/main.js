!function(t){var e={};function n(i){if(e[i])return e[i].exports;var s=e[i]={i:i,l:!1,exports:{}};return t[i].call(s.exports,s,s.exports,n),s.l=!0,s.exports}n.m=t,n.c=e,n.d=function(t,e,i){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:i})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var i=Object.create(null);if(n.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var s in t)n.d(i,s,function(e){return t[e]}.bind(null,s));return i},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="",n(n.s=4)}([function(t,e,n){var i=n(1),s=n(2);"string"==typeof(s=s.__esModule?s.default:s)&&(s=[[t.i,s,""]]);var o={insert:"head",singleton:!1};i(s,o);t.exports=s.locals||{}},function(t,e,n){"use strict";var i,s=function(){return void 0===i&&(i=Boolean(window&&document&&document.all&&!window.atob)),i},o=function(){var t={};return function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}t[e]=n}return t[e]}}(),r=[];function a(t){for(var e=-1,n=0;n<r.length;n++)if(r[n].identifier===t){e=n;break}return e}function u(t,e){for(var n={},i=[],s=0;s<t.length;s++){var o=t[s],u=e.base?o[0]+e.base:o[0],c=n[u]||0,d="".concat(u," ").concat(c);n[u]=c+1;var l=a(d),h={css:o[1],media:o[2],sourceMap:o[3]};-1!==l?(r[l].references++,r[l].updater(h)):r.push({identifier:d,updater:f(h,e),references:1}),i.push(d)}return i}function c(t){var e=document.createElement("style"),i=t.attributes||{};if(void 0===i.nonce){var s=n.nc;s&&(i.nonce=s)}if(Object.keys(i).forEach((function(t){e.setAttribute(t,i[t])})),"function"==typeof t.insert)t.insert(e);else{var r=o(t.insert||"head");if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(e)}return e}var d,l=(d=[],function(t,e){return d[t]=e,d.filter(Boolean).join("\n")});function h(t,e,n,i){var s=n?"":i.media?"@media ".concat(i.media," {").concat(i.css,"}"):i.css;if(t.styleSheet)t.styleSheet.cssText=l(e,s);else{var o=document.createTextNode(s),r=t.childNodes;r[e]&&t.removeChild(r[e]),r.length?t.insertBefore(o,r[e]):t.appendChild(o)}}function p(t,e,n){var i=n.css,s=n.media,o=n.sourceMap;if(s?t.setAttribute("media",s):t.removeAttribute("media"),o&&btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(o))))," */")),t.styleSheet)t.styleSheet.cssText=i;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(i))}}var v=null,m=0;function f(t,e){var n,i,s;if(e.singleton){var o=m++;n=v||(v=c(e)),i=h.bind(null,n,o,!1),s=h.bind(null,n,o,!0)}else n=c(e),i=p.bind(null,n,e),s=function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(n)};return i(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap)return;i(t=e)}else s()}}t.exports=function(t,e){(e=e||{}).singleton||"boolean"==typeof e.singleton||(e.singleton=s());var n=u(t=t||[],e);return function(t){if(t=t||[],"[object Array]"===Object.prototype.toString.call(t)){for(var i=0;i<n.length;i++){var s=a(n[i]);r[s].references--}for(var o=u(t,e),c=0;c<n.length;c++){var d=a(n[c]);0===r[d].references&&(r[d].updater(),r.splice(d,1))}n=o}}}},function(t,e,n){(e=n(3)(!1)).push([t.i,"@import url(https://fonts.googleapis.com/css2?family=Open+Sans:wght@300;400;700&display=swap);"]),e.push([t.i,"body {\n  font-family: 'Open Sans', sans-serif;\n}\n\n#canvas {\n  position: relative;\n  border: 1px solid black;\n  overflow: hidden;\n  display: inline-block;\n  font-size: 0;\n}\n\n.point {\n  position: absolute;\n  width: 40px;\n  height: 40px;\n  background: rgba(0,0, 0, .5);\n  border-radius: 50%;\n  border: 0;\n  left: calc(var(--x) - 25px);\n  top: calc(var(--y) - 25px);\n  border: 3px solid rgba(255, 0, 0, 0.271);\n  margin: 0;\n  padding: 0;\n}\n\n.point.selected {\n  border: 3px solid red;\n}\n\n.output {\n  display: grid;\n  grid-template-columns: 1fr 1fr;\n  max-width: 600px;\n}\n\n.output h2 {\n  grid-column: 1 / 3;\n}\n\n#output-image {\n  max-width: 300px;\n  grid-column: 1 / 2;\n}\n\n.edit {\n  grid-column: 2 / 3;\n  display: grid;\n  grid-template-columns: 1fr;\n  grid-template-rows: repeat(1fr, 4);\n  padding: 20px;\n  align-items: center;\n}\n\n#update-output {\n  height: 40px;\n  border: 0;\n  cursor: pointer;\n}\n",""]),t.exports=e},function(t,e,n){"use strict";t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var n=function(t,e){var n=t[1]||"",i=t[3];if(!i)return n;if(e&&"function"==typeof btoa){var s=(r=i,a=btoa(unescape(encodeURIComponent(JSON.stringify(r)))),u="sourceMappingURL=data:application/json;charset=utf-8;base64,".concat(a),"/*# ".concat(u," */")),o=i.sources.map((function(t){return"/*# sourceURL=".concat(i.sourceRoot||"").concat(t," */")}));return[n].concat(o).concat([s]).join("\n")}var r,a,u;return[n].join("\n")}(e,t);return e[2]?"@media ".concat(e[2]," {").concat(n,"}"):n})).join("")},e.i=function(t,n,i){"string"==typeof t&&(t=[[null,t,""]]);var s={};if(i)for(var o=0;o<this.length;o++){var r=this[o][0];null!=r&&(s[r]=!0)}for(var a=0;a<t.length;a++){var u=[].concat(t[a]);i&&s[u[0]]||(n&&(u[2]?u[2]="".concat(n," and ").concat(u[2]):u[2]=n),e.push(u))}},e}},function(t,e,n){"use strict";n.r(e);n(0);class i{constructor(){this.events={}}on(t,e){return"object"!=typeof this.events[t]&&(this.events[t]=[]),this.events[t].push(e),()=>this.removeListener(t,e)}removeListener(t,e){if("object"==typeof this.events[t]){const n=this.events[t].indexOf(e);n>-1&&this.events[t].splice(n,1)}}emit(t,...e){"object"==typeof this.events[t]&&this.events[t].forEach(t=>t.apply(this,e))}once(t,e){const n=this.on(t,(...t)=>{n(),e.apply(this,t)})}}class s{constructor(t,e){this.canvas=t,this.eventBus=e,this.info=null,this.el=null}createPointElement(t){const e=document.createElement("button");return e.classList.add("point"),e.id=t.id,e.style=`--x: ${t.x}px; --y: ${t.y}px;`,e}setPointOnCanvas(t){const e=this.createPointElement(t);e.addEventListener("pointerdown",e=>this.handlePointMovement(e,t),!1),this.canvas.append(e)}setCurrent(t){this.currentPoint=t,this.eventBus.emit("currentPointUpdated",t),this.eventBus.emit("handleStart")}handlePointMovement(t,e){this.setCurrent(e),this.selectPoint(t)}updatePointView(t){if(!t)return;document.getElementById(t.id).style=`--x: ${t.x}px; --y: ${t.y}px;`}unselectPoint(t){this.currentPoint=null,this.eventBus.emit("currentPointUpdated",null);document.getElementById(t.id).classList.remove("selected")}selectPoint(t){t.target.classList.add("selected")}}class o extends class{constructor(){this.canvas=null,this.current=null,this.eventBus=null,this.pressed=!1}setPressed(t){this.pressed=t}handleStart(t){this.setPressed(!0),console.log("start",this.pressed)}handleEnd(t,e){this.setPressed(!1),this.eventBus.emit("pointOut",this.current),e.setcurrent(null,null,e),console.log("end",this.pressed)}handleCancel(t){this.setPressed(!1),console.log("cancel",this.pressed)}handleMove(t,e){this.current&&this.pressed&&(e.setcurrent(t.clientX,t.clientY,e),console.log("move",this.pressed))}setcurrent(t,e,n){(t||e)&&this.eventBus.emit("pointUpdate",{x:t,y:e})}handleMovement(t,e){if(this.current)switch(t.type){case"pointerdown":e.handleStart(t);break;case"pointerup":e.handleEnd(t,e);break;case"pointercancel":e.handleCancel(t);break;case"pointermove":e.handleMove(t,e)}}bindPointerEvents(){this.canvas.addEventListener("pointerdown",t=>this.handleMovement(t,this),!1),this.canvas.addEventListener("pointerup",t=>this.handleMovement(t,this),!1),this.canvas.addEventListener("pointercancel",t=>this.handleMovement(t,this),!1),this.canvas.addEventListener("pointermove",t=>this.handleMovement(t,this),!1)}unbindPointerEvents(){console.log("editor unbindPointerEvents"),this.pressed=!1,this.current=null}}{constructor(t,e){super(),this.canvas=document.getElementById("canvas"),this.points=t,this.eventBus=e,this.init()}init(){this.point=new s(this.canvas,this.eventBus),this.setPointsOnCanvas(),this.listenToEvents(),this.bindPointerEvents()}setPoints(t){this.points=t}setCurrent(t){this.current=t}setPointsOnCanvas(){this.points.forEach(t=>{this.point.setPointOnCanvas(t)})}updatePoint(t){this.current=Object.assign(this.current,t),this.points.concat(this.points,this.current),this.point.updatePointView(this.current)}listenToEvents(){this.eventBus.on("currentPointUpdated",t=>{this.setCurrent(t)}),this.eventBus.on("pointUpdate",t=>{this.updatePoint(t)}),this.eventBus.on("pointOut",t=>{this.point.unselectPoint(t)})}}class r{constructor(t,e,n,i,s){this.eventBus=t,this.outputImage=document.getElementById("output-image"),this.initialPoint=e,this.canvasWidth=n,this.canvasHeight=this.calcHeightRatio(i,s),this.transformations=[{proportion:!0,type:"crop",val:"300x250"},{type:"zoom",val:"2"}],this.transform=this.handleTransformation(this.transformations),this.init(),this.setWidthField(),this.setHeightField(),this.setTypeField(),this.setZoomField();document.getElementById("update-output").addEventListener("click",t=>{this.updateProportion()})}init(){this.setNewTransform(this.transform),this.setNewFocus(this.initialPoint),this.imageEventsListener()}calcHeightRatio(t,e){const n=100*this.canvasWidth/t/100;return parseInt(e*n)}handleProp(t){return t.type+"="+t.val}handleTransformation(t){return t.map(t=>this.handleProp(t)).join("/")}setNewTransform(t){console.log(t),this.outputImage.setAttribute("data-src-transform",t)}updateProportion(){this.transformations=this.transformations.map(t=>(t.proportion?(console.log(document.getElementById("output-width").value),t.val=`${document.getElementById("output-width").value}x${document.getElementById("output-height").value}`,t.type=document.getElementById("output-type").value):"zoom"===t.type&&(t.val=document.getElementById("output-zoom").value),t)),this.transform=this.handleTransformation(this.transformations),this.setNewTransform(this.transform)}setTypeField(){document.getElementById("output-type").value=this.transformations.find(t=>t.proportion).type}setWidthField(){document.getElementById("output-width").value=this.transformations.find(t=>t.proportion).val.split("x")[0]}setHeightField(){document.getElementById("output-height").value=this.transformations.find(t=>t.proportion).val.split("x")[1]}setZoomField(){document.getElementById("output-zoom").value=this.transformations.find(t=>"zoom"===t.type).val}setNewFocus(t){const e=100*t.x/this.canvasWidth,n=100*t.y/this.canvasHeight;this.outputImage.setAttribute("data-src-focus",`${parseInt(e)}px${parseInt(n)}p`)}imageEventsListener(){this.eventBus.on("pointOut",t=>{this.setNewFocus(t)})}}new class{constructor(){this.twicPicsEditor=document.getElementById("twicpics-editor"),this.initialWidth=Number(this.twicPicsEditor.getAttribute("data-original-width")),this.initialHeight=Number(this.twicPicsEditor.getAttribute("data-original-height")),this.canvasWidth=600,this.initialPoint={id:1,x:140,y:227},this.init()}init(){this.renderCanvas();const t=new i;new o([this.initialPoint],t),new r(t,this.initialPoint,this.canvasWidth,this.initialWidth,this.initialHeight)}setWidth(t){document.getElementById("output-width").value=t}setHeight(t){document.getElementById("output-height").value=t}renderCanvas(){const t=document.createElement("div");t.id="canvas",t.innerHTML=`\n      <img id="edit-image" \n        class="twic" \n        data-src-transform="resize=${this.canvasWidth}"\n        data-src="image:example-1.jpg"/>`;const e=document.createElement("div");e.id="output",e.innerHTML='\n      <div class="output">\n        <h2>Output</h2>\n        <img class="twic" id="output-image" data-src="image:example-1.jpg">\n        <div class="edit">\n          <select id="output-type">\n            <option value="crop">Crop</option>\n            <option value="contain">Contain</option>\n            <option value="cover">Cover</option>\n          </select>\n          <label>\n            Width:\n            <input type="number" step="25" name="width" id="output-width" val="" />\n          </label>\n          <label>\n            Height:\n            <input type="number" step="25" name="height" id="output-height" val="" />\n          </label>\n          <select id="output-zoom">\n            <option value="1">Normal</option>\n            <option value="2">x2</option>\n            <option value="3">x3</option>\n            <option value="4">x4</option>\n          </select>\n          <button id="update-output">Update</button>\n        </div>\n      </div>',this.twicPicsEditor.append(t),this.twicPicsEditor.append(e)}}}]);